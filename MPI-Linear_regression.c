#include <stdio.h>
#include <math.h>
#include <time.h>
#include <mpi.h>

typedef struct point_t
{
  double xIntercept;
  double yIntercept;
} point_t;
struct timespec start, end;
long long int time_taken;
int n_data = 1000;
point_t data[];

point_t data[] = {
  {78.99,108.01},{85.04,146.71},{82.60,135.33},{65.96,115.13},
  {83.32,127.88},{72.47,117.63},{73.94,127.86},{68.03,119.80},
  {65.36,104.39},{72.21,125.05},{73.91,114.63},{68.81,109.11},
  {82.96,144.33},{73.07,135.92},{83.36,121.14},{30.32,58.07},
  {78.12,130.44},{39.75,65.44},{57.57,88.87},{17.51,45.41},
  { 8.00,43.00},{ 7.37,37.21},{28.96,77.98},{39.94,96.24},
  {47.29,107.36},{70.88,102.87},{22.04,65.14},{16.70,63.43},
  {39.40,82.65},{54.97,96.65},{77.35,126.63},{79.27,135.48},
  {41.89,81.49},{87.97,127.71},{57.89,94.58},{24.07,62.06},
  {13.59,60.37},{73.79,128.83},{44.43,77.19},{56.31,106.71},
  {37.79,84.83},{77.68,131.13},{45.93,98.74},{59.22,106.96},
  { 6.77,44.00},{61.73,102.80},{47.95,78.76},{43.21,76.19},
  {90.48,132.53},{41.01,83.81},{87.90,129.50},{82.33,126.74},
  {84.46,155.99},{50.44,81.99},{16.17,58.76},{25.33,69.91},
  {61.32,101.46},{22.01,74.76},{78.24,133.53},{79.52,130.56},
  {54.73,102.06},{21.50,47.03},{22.82,62.80},{11.74,44.63},
  {66.44,117.55},{98.18,143.67},{17.84,60.07},{83.87,137.02},
  {12.86,60.96},{78.49,128.53},{40.10,88.76},{ 6.47,31.45},
  {58.63,94.21},{76.76,136.41},{26.22,73.78},{ 2.04,41.67},
  {54.21,87.53},{49.96,86.45},{60.79,133.85},{14.03,43.42},
  {53.59,114.22},{38.72,73.73},{66.24,117.39},{71.58,117.08},
  {85.07,121.43},{98.91,150.54},{43.00,62.70},{42.77,80.92},
  {33.91,88.18},{50.46,87.74},{96.03,158.65},{65.23,134.55},
  {56.84,119.72},{85.39,128.89},{68.18,109.88},{98.29,156.03},
  {95.18,135.71},{99.77,147.91},{38.72,81.02},{35.23,63.53},
  {17.26,47.95},{81.76,125.65},{47.25,100.59},{95.23,141.49},
  {20.00,54.54},{39.19,81.10},{15.41,45.96},{ 0.81,33.32},
  { 1.55,21.32},{42.82,90.13},{32.90,71.88},{99.25,158.56},
  {82.27,125.77},{82.60,132.58},{31.64,86.74},{ 8.02,41.34},
  {11.00,32.86},{58.29,109.11},{25.19,55.09},{19.30,62.87},
  {76.29,136.60},{83.05,133.72},{74.83,121.85},{49.80,84.96},
  {15.45,66.23},{47.41,89.25},{49.21,86.21},{60.34,106.58},
  {36.42,82.17},{16.61,47.16},{61.52,105.16},{59.44,101.65},
  {79.38,130.70},{65.50,108.67},{59.47,112.57},{71.55,121.32},
  {69.31,101.34},{61.59,105.76},{75.37,123.50},{59.50,106.08},
  { 3.09,39.61},{82.90,150.24},{29.23,66.75},{31.59,70.13},
  {65.95,105.56},{22.31,62.98},{ 3.34,49.29},{32.27,67.53},
  {68.16,105.22},{ 7.88,57.99},{53.79,96.88},{89.89,155.12},
  {45.73,65.64},{10.81,39.72},{ 6.08,34.90},{70.95,132.33},
  {41.31,76.97},{85.88,136.65},{90.37,128.48},{15.46,66.23},
  {32.01,85.13},{30.14,57.04},{96.79,162.24},{12.40,43.63},
  { 1.91,28.07},{66.97,105.63},{30.56,78.91},{96.28,141.79},
  {35.88,70.76},{48.39,94.21},{89.18,140.54},{ 7.47,27.63},
  {19.68,49.17},{80.55,152.49},{49.60,109.22},{62.47,115.47},
  {92.59,154.97},{69.98,124.31},{89.87,132.13},{ 2.02,29.81},
  {29.56,73.74},{87.91,146.55},{15.63,45.95},{84.98,143.85},
  {85.64,146.18},{55.16,90.30},{32.91,83.94},{48.13,75.49},
  {40.84,88.19},{58.30,90.80},{22.89,69.86},{51.73,98.24},
  {98.74,129.99},{97.55,138.60},{90.59,135.33},{14.63,59.60},
  {82.33,133.58},{ 4.88,33.69},{69.81,115.70},{53.55,99.11},
  {78.05,132.93},{69.61,124.74},{10.12,66.05},{31.71,70.69},
  {94.62,162.58},{60.63,99.04},{17.06,81.09},{ 3.82,46.87},
  {93.51,145.14},{31.38,84.96},{78.20,133.28},{11.19,51.05},
  {62.41,114.37},{73.28,114.35},{66.90,138.67},{93.08,156.39},
  {72.60,132.10},{99.18,140.63},{38.59,97.41},{26.46,54.77},
  {64.98,95.30},{ 3.50,28.42},{71.21,111.47},{55.05,98.76},
  {75.32,133.02},{54.85,78.98},{67.43,113.21},{34.26,87.49},
  {34.32,63.01},{89.59,145.35},{63.13,108.46},{97.43,148.61},
  {94.36,140.85},{28.17,82.01},{ 7.03,39.19},{62.62,103.26},
  {89.31,138.86},{64.89,130.97},{89.53,133.88},{45.58,102.64},
  {89.89,149.19},{18.59,54.85},{67.11,107.88},{41.39,70.71},
  {25.26,64.82},{82.02,154.58},{22.55,53.30},{80.40,131.83},
  {49.86,97.52},{47.02,103.35},{37.05,85.98},{27.65,69.14},
  {41.32,81.83},{30.79,77.79},{90.38,131.05},{36.01,87.49},
  {71.20,118.23},{34.06,74.84},{80.14,106.35},{26.73,64.62},
  {55.07,95.16},{24.48,64.72},{14.42,45.16},{15.23,61.57},
  {75.00,135.50},{62.36,116.86},{31.43,61.39},{39.80,76.55},
  {60.55,111.42},{ 6.52,28.27},{43.62,78.56},{15.16,39.17},
  {82.36,110.59},{ 2.71,57.00},{58.06,113.31},{94.58,128.19},
  {93.03,145.21},{93.01,132.84},{21.64,63.96},{85.82,142.47},
  { 3.53,24.67},{80.17,123.77},{48.46,108.11},{74.44,126.95},
  {63.72,94.60},{29.04,76.37},{71.55,123.90},{53.99,122.82},
  {41.14,88.24},{30.45,75.80},{60.10,89.83},{49.41,95.84},
  {63.55,113.90},{98.68,148.43},{29.42,57.06},{76.30,136.13},
  {43.69,75.01},{82.12,134.16},{ 7.57,47.63},{79.64,131.38},
  {37.13,87.31},{ 2.77,47.56},{19.08,55.79},{19.32,67.34},
  {94.50,163.58},{40.64,93.24},{58.92,105.97},{99.26,143.24},
  {81.39,115.94},{15.21,53.60},{17.00,59.53},{45.28,93.78},
  { 1.63,38.26},{32.18,55.53},{64.82,115.09},{65.88,116.24},
  {95.82,143.08},{79.53,154.82},{67.53,118.22},{66.78,125.96},
  {59.06,94.01},{19.23,43.27},{49.75,80.67},{80.56,127.60},
  {87.11,140.54},{29.00,64.80},{15.58,61.40},{15.17,53.26},
  {59.64,104.05},{72.94,118.12},{95.25,151.92},{54.34,91.62},
  {48.39,88.93},{11.24,35.63},{26.29,54.40},{45.47,101.28},
  {25.79,63.90},{36.11,74.82},{ 3.14,56.40},{44.68,87.22},
  {56.86,100.43},{35.18,67.16},{40.46,83.94},{ 2.11,19.46},
  {89.69,158.95},{31.62,67.88},{44.58,81.27},{ 9.24,36.62},
  {31.92,62.18},{49.24,91.13},{13.43,38.94},{25.93,68.92},
  {95.21,135.36},{72.58,132.15},{38.68,60.12},{81.36,131.47},
  {41.71,63.10},{79.94,125.91},{58.62,104.29},{58.98,99.43},
  {27.06,81.57},{37.90,70.96},{ 7.42,29.08},{16.14,59.40},
  {40.52,78.15},{19.43,74.99},{48.87,88.01},{70.11,114.73},
  { 8.13,49.54},{47.83,98.93},{27.96,48.85},{29.63,66.05},
  {40.65,73.84},{55.11,99.59},{60.85,114.36},{76.24,121.48},
  {14.18,52.46},{78.66,132.86},{22.79,61.06},{37.13,70.96},
  {25.02,59.48},{26.53,49.57},{52.37,86.89},{14.50,59.81},
  { 9.82,46.49},{ 2.02,29.04},{33.50,84.01},{28.17,77.46},
  {94.08,130.37},{56.76,118.65},{83.99,124.91},{88.05,135.34},
  {97.91,172.45},{24.69,61.76},{33.81,83.88},{22.09,64.03},
  {90.03,146.00},{36.25,74.57},{12.46,49.70},{62.56,97.87},
  {16.62,56.16},{85.15,139.48},{15.54,43.36},{49.53,85.15},
  {56.67,106.17},{62.18,96.61},{98.09,168.35},{75.34,116.55},
  {38.40,88.36},{68.95,112.91},{25.46,53.15},{ 9.13,55.69},
  {27.97,65.12},{30.93,63.92},{49.12,88.89},{41.96,103.22},
  {99.14,156.92},{46.22,90.92},{58.79,103.66},{ 2.53,27.92},
  {75.33,128.49},{82.10,149.27},{65.39,104.13},{ 1.85,35.97},
  {65.78,120.30},{29.68,75.12},{65.74,103.90},{99.54,161.29},
  {14.52,57.63},{47.47,78.77},{ 7.95,34.46},{90.82,155.09},
  {71.59,133.90},{89.49,153.14},{57.93,116.28},{47.99,74.26},
  {20.44,58.98},{73.54,113.23},{30.84,73.88},{ 6.91,58.59},
  { 1.79,15.96},{45.49,87.79},{89.97,147.34},{57.76,116.88},
  { 0.23,43.77},{11.47,35.62},{ 5.46,50.16},{34.17,78.56},
  {88.64,139.37},{55.09,112.72},{38.53,86.65},{97.32,155.17},
  {73.25,115.38},{23.21,58.75},{86.13,128.05},{90.20,133.48},
  {40.16,68.25},{61.19,117.13},{43.03,94.27},{42.22,92.62},
  {94.00,146.34},{69.42,116.50},{88.15,152.99},{69.25,114.78},
  {10.34,37.73},{83.92,148.35},{ 6.80,39.17},{25.99,73.77},
  {47.03,96.44},{97.72,114.06},{13.63,53.06},{87.04,146.57},
  {67.36,111.13},{76.86,138.03},{16.41,69.96},{55.61,105.23},
  {82.21,135.04},{62.76,101.53},{ 3.62,60.08},{90.95,141.74},
  {68.89,103.99},{45.21,98.68},{ 3.36,34.30},{15.00,57.96},
  { 3.37,49.61},{28.83,71.55},{27.91,58.89},{45.48,75.97},
  {64.70,111.04},{64.58,102.48},{61.72,116.26},{40.97,60.04},
  {32.95,86.19},{89.64,148.32},{73.86,118.17},{30.19,80.74},
  {76.12,112.25},{52.03,90.35},{14.90,60.83},{61.01,117.16},
  { 0.40,37.57},{22.47,72.41},{58.08,80.61},{45.38,80.86},
  {42.47,95.61},{75.50,123.75},{33.35,58.00},{88.61,148.52},
  {62.24,126.01},{96.85,151.26},{50.53,93.91},{75.35,125.80},
  {98.64,142.60},{61.75,125.55},{15.87,60.64},{87.17,154.22},
  {66.54,107.01},{88.36,149.90},{51.15,100.64},{63.16,108.20},
  {17.99,46.33},{15.88,61.09},{62.21,98.99},{19.57,45.51},
  {61.56,109.08},{86.94,134.48},{27.34,50.76},{74.96,108.40},
  {74.27,130.72},{46.70,89.14},{ 4.01,29.49},{ 1.98,28.77},
  {60.21,90.09},{54.37,100.55},{95.46,150.89},{54.22,91.74},
  {21.51,56.43},{13.84,66.03},{12.13,39.48},{78.47,122.99},
  {57.65,105.86},{ 8.77,26.99},{15.21,50.34},{ 5.33,50.94},
  {62.55,110.78},{ 7.66,58.23},{62.67,96.53},{98.39,139.26},
  {63.88,117.08},{22.00,64.22},{78.48,152.62},{77.64,134.02},
  {83.04,132.16},{36.86,102.01},{58.15,111.51},{ 9.33,50.23},
  {76.03,132.74},{ 1.21,46.44},{96.38,151.14},{44.94,79.88},
  {27.07,68.24},{27.32,80.70},{34.85,71.16},{94.14,133.00},
  {77.79,131.64},{75.60,137.51},{52.03,95.97},{68.66,103.89},
  {36.07,83.18},{25.42,68.80},{42.38,74.74},{68.60,142.38},
  {77.11,139.42},{77.84,137.32},{34.50,67.08},{41.99,70.68},
  {59.72,114.23},{17.99,42.57},{50.92,107.19},{93.58,159.96},
  {67.38,103.03},{27.46,72.43},{18.02,60.74},{32.22,92.42},
  {73.10,120.06},{33.04,76.24},{30.29,76.45},{63.61,119.57},
  {63.60,113.94},{56.20,84.04},{95.38,135.49},{65.96,125.51},
  { 7.48,32.16},{91.45,153.89},{14.82,52.73},{11.93,44.98},
  {19.65,57.70},{55.31,89.14},{ 4.60,42.55},{21.62,49.69},
  {58.36,95.55},{14.17,68.44},{85.79,148.57},{ 1.79,29.47},
  {50.70,92.52},{ 1.85,36.85},{79.42,137.66},{19.11,50.93},
  {61.09,108.80},{69.01,129.00},{92.98,146.21},{91.36,146.04},
  {43.87,101.94},{83.49,129.59},{71.79,109.25},{17.89,46.86},
  {42.96,110.48},{56.71,111.30},{14.52,47.92},{75.15,141.99},
  {43.43,74.90},{27.66,59.76},{51.91,105.65},{40.33,89.52},
  {19.57,39.49},{34.31,67.39},{95.90,178.04},{44.26,82.39},
  {28.09,65.02},{11.05,44.85},{39.40,89.82},{ 6.43,49.55},
  {35.56,77.82},{21.65,65.71},{57.20,105.17},{ 6.82,36.77},
  {42.96,85.82},{50.77,98.10},{43.19,71.86},{67.78,113.14},
  {98.22,157.23},{62.88,101.00},{33.72,77.28},{74.38,120.87},
  {16.45,69.22},{ 5.40,39.19},{72.73,136.45},{48.67,108.83},
  { 2.90,44.67},{83.93,132.94},{26.42,62.13},{85.10,154.74},
  {84.42,124.18},{30.89,79.75},{33.10,80.46},{29.82,68.26},
  {38.17,71.63},{69.91,116.40},{13.90,61.90},{78.76,118.72},
  {84.01,127.22},{37.20,78.80},{91.17,146.87},{40.62,86.19},
  {59.56,104.16},{13.77,58.14},{76.98,123.74},{10.32,58.92},
  {46.13,100.67},{32.71,78.80},{ 2.29,35.64},{48.65,104.84},
  {71.93,118.84},{67.53,110.47},{81.18,119.22},{ 5.67,36.14},
  {46.76,93.59},{82.73,136.44},{53.55,88.70},{ 9.37,27.04},
  {95.60,133.60},{86.98,138.83},{81.85,131.94},{45.13,98.07},
  {71.76,118.13},{ 4.76,38.38},{91.64,164.02},{96.86,162.60},
  {48.12,94.77},{ 6.45,45.17},{44.30,90.52},{89.85,141.49},
  {25.25,57.00},{45.76,98.17},{57.34,98.14},{93.69,142.08},
  {12.99,36.93},{47.97,82.77},{ 4.37,36.35},{64.63,113.00},
  {13.37,37.72},{14.88,44.13},{15.00,73.98},{ 6.94,48.24},
  {89.44,149.84},{44.64,75.34},{92.85,158.96},{69.49,112.42},
  {22.71,61.18},{ 6.19,42.91},{23.12,72.25},{89.90,132.40},
  {15.14,40.16},{91.29,131.43},{49.78,96.14},{ 1.15,30.93},
  {27.30,50.38},{96.00,137.85},{13.34,45.33},{68.11,117.13},
  {90.75,138.38},{42.41,79.40},{12.80,54.89},{80.95,123.15},
  {56.55,73.52},{ 1.25,42.00},{15.61,41.03},{20.11,66.96},
  {37.51,83.42},{62.24,104.27},{71.80,111.89},{52.07,87.22},
  {97.81,150.08},{12.65,64.65},{66.48,115.19},{31.20,62.19},
  {20.37,77.62},{94.03,142.16},{16.04,47.73},{97.60,148.24},
  {96.46,147.05},{31.53,49.09},{ 5.15,52.20},{84.63,139.45},
  {20.13,53.49},{89.74,148.06},{75.99,104.54},{32.35,54.24},
  {38.10,67.61},{16.92,65.57},{16.04,28.29},{57.31,75.66},
  {79.53,143.23},{89.20,138.11},{88.22,131.65},{27.73,76.75},
  {71.78,140.05},{55.17,89.45},{64.58,113.23},{ 2.50,29.22},
  {81.41,124.38},{76.39,129.25},{74.04,123.25},{46.80,88.75},
  {96.23,144.70},{ 4.05,37.78},{ 4.23,26.16},{ 7.52,34.59},
  {25.12,68.84},{79.89,141.07},{18.38,41.29},{19.57,59.58},
  {99.72,137.03},{95.56,145.40},{48.07,99.70},{67.52,123.42},
  {68.02,132.39},{42.58,69.71},{72.80,106.14},{83.82,134.08},
  { 1.79,46.31},{47.28,103.63},{27.92,76.13},{43.69,84.36},
  {42.80,86.03},{75.93,133.25},{91.23,131.13},{28.66,69.07},
  {10.42,59.23},{47.25,114.05},{ 9.97,50.99},{14.15,41.37},
  {51.95,102.78},{92.75,146.59},{55.41,103.43},{ 2.00,43.55},
  {57.21,110.86},{43.60,85.26},{74.58,121.03},{83.13,141.58},
  {63.12,107.46},{58.21,116.99},{86.68,132.43},{67.64,115.16},
  {98.08,145.24},{71.39,136.51},{ 5.94,40.64},{78.10,136.38},
  {87.95,147.50},{61.37,96.41},{25.74,77.03},{73.68,124.34},
  { 9.28,53.96},{48.88,107.94},{52.80,91.98},{78.12,127.25},
  {37.49,72.46},{76.59,131.12},{21.83,59.24},{16.74,75.90},
  {90.07,142.07},{62.83,120.74},{66.34,106.35},{64.96,118.09},
  {72.89,110.39},{99.04,147.25},{85.61,153.60},{77.98,149.58},
  {92.34,143.56},{56.52,106.18},{84.70,148.84},{94.73,147.56},
  {67.60,122.58},{28.42,74.88},{67.91,104.65},{38.06,78.52},
  {13.05,62.71},{71.94,128.50},{95.04,149.86},{74.02,133.06},
  {83.51,146.23},{ 1.90,26.49},{41.46,89.27},{63.27,112.03},
  {63.01,117.44},{87.39,141.40},{33.13,83.73},{60.55,107.71},
  {26.13,71.67},{ 7.06,46.44},{68.40,123.10},{80.79,125.21},
  {94.92,139.87},{25.25,81.51},{41.17,86.66},{55.15,95.50},
  {32.99,68.10},{83.34,124.11},{40.57,70.93},{66.65,103.69},
  {86.49,136.49},{17.48,44.80},{42.92,78.50},{47.88,106.07},
  {23.92,80.36},{65.52,125.55},{80.15,127.78},{ 2.15,40.16},
  {40.59,76.17},{ 3.05,57.31},{ 8.28,33.07},{43.88,92.19},
  {99.30,161.70},{15.81,62.45},{52.73,104.68},{93.29,128.51},
  {30.93,73.71},{50.35,95.20},{83.37,140.94},{54.37,89.17},
  {33.30,67.20},{77.57,119.34},{ 2.25,31.27},{61.47,103.98},
  {21.70,65.70},{79.51,139.42},{23.50,60.72},{45.07,92.23},
  {60.77,116.90},{ 1.40,45.41},{17.76,51.32},{90.42,152.03},
  {42.54,67.43},{82.93,122.11},{55.33,103.95},{93.23,158.23},
  {43.50,104.53},{14.42,46.04},{81.35,146.95},{ 1.53,24.40},
  {51.05,93.83},{14.25,46.04},{81.26,132.31},{ 0.15,43.76},
  {72.47,106.76},{56.79,114.48},{62.51,116.46},{81.77,116.43},
  {51.85,97.14},{ 3.54,52.00},{32.70,74.94},{76.43,122.16},
  {12.18,38.49},{15.36,39.16},{58.26,95.16},{29.44,64.54},
  {93.75,150.38},{70.31,128.57},{81.15,130.25},{13.88,48.89},
  {81.69,136.87},{43.36,89.23},{21.10,65.55},{19.58,79.37},
  {91.65,148.00},{24.99,66.18},{31.87,85.81},{56.29,112.40},
  {88.21,147.29},{22.33,64.84},{22.53,79.66},{51.99,94.99},
  { 6.59,34.02},{48.24,85.97},{70.41,114.25},{38.34,81.24},
  { 6.44,33.60},{ 5.41,33.25},{51.75,98.72},{90.08,135.49},
  {40.41,85.63},{83.66,148.13},{ 5.38,27.20},{ 5.73,50.99},
  {11.53,40.08},{75.78,130.74},{97.21,161.30},{29.40,55.27},
  { 1.30,45.32},{12.27,60.35},{65.49,118.11},{94.36,158.13},
  {94.78,138.61},{ 7.92,44.13},{47.33,96.20},{53.69,99.38},
  {30.54,66.20},{81.97,134.55},{53.62,89.50},{99.42,160.47},
  {78.72,144.06},{77.33,117.77},{ 8.29,60.42},{86.83,143.78},
  {11.67,58.09},{99.68,150.28},{81.97,136.21},{37.15,77.71},
  {65.97,98.75},{32.08,73.30},{60.53,107.95},{85.48,140.53},
  {65.14,126.36},{83.77,142.43},{89.56,130.48},{36.73,92.51},
  {35.15,74.93},{66.35,109.47},{17.59,70.85},{28.01,85.72},
  {40.31,85.83},{83.25,131.21},{36.02,67.59},{91.56,138.43},
  {17.17,65.29},{98.88,139.32},{33.70,78.34},{89.33,145.69},
  { 0.33,38.21},{16.96,37.60},{20.99,66.13},{18.81,49.25},
  {16.59,74.96},{59.25,108.94},{54.31,94.30},{74.72,141.48},
  {96.26,153.00},{33.33,74.83},{93.23,134.26},{76.75,123.18}
};


double residual_error(double xIntercept, double yIntercept, double slope, double c) 
{
  double e = (slope * xIntercept) + c - yIntercept;
  return e * e;
}

double rms_error(double slope, double c) 
{
  int k;
  double mean;
  double error_sum = 0;
  
  for(k=0; k<n_data; k++) {
    error_sum += residual_error(data[k].xIntercept, data[k].yIntercept, slope, c);  
  }
  
  mean = error_sum / n_data;
  
  return sqrt(mean);
}

int t_difference(struct timespec *start, struct timespec *end, long long int *difference)
{
long long int ds = end->tv_sec - start->tv_sec;
long long int dn = end->tv_nsec - start->tv_nsec;

 if(dn < 0){
  ds--;
  dn += 1000000000;
}
  *difference = ds * 1000000000 + dn;
  return !(*difference > 0); 
}

int main() 
{
  clock_gettime(CLOCK_MONOTONIC, &start);

  int rank_is, size_is;
  int k;
  double bm = 1.3;
  double bc = 10;
  double be;
  double dm[8];
  double dc[8];
  double e[8];
  double step = 0.01;
  double best_error = 999999999;
  int best_error_i;
  int min_found = 0;
  double pError = 0;
  double baseMC[2];
  double om[] = {0,1,1, 1, 0,-1,-1,-1};
  double oc[] = {1,1,0,-1,-1,-1, 0, 1};

  MPI_Init(NULL, NULL);
  MPI_Comm_size(MPI_COMM_WORLD, &size_is);
  MPI_Comm_rank(MPI_COMM_WORLD, &rank_is);

  be = rms_error(bm, bc);

  if(size_is != 9)
  {
    if(rank_is == 0) 
    {
      printf("This program requires 9 processes to run!!!\n");
      return 0;
     }
   } 

  while(!min_found)
  {
    if (rank_is != 0)
	{
		k = rank_is -1;
		dm[k] = bm + (om[k] * step);
		dc[k] = bc + (oc[k] * step);
		pError = rms_error (dm[k], dc[k]);
        MPI_Send (&pError, 1, MPI_DOUBLE, 0, 0, MPI_COMM_WORLD);
		MPI_Send (&dm[k], 1, MPI_DOUBLE, 0, 0, MPI_COMM_WORLD);
		MPI_Send (&dc[k], 1, MPI_DOUBLE, 0, 0, MPI_COMM_WORLD);
        MPI_Recv (&bm, 1, MPI_DOUBLE, 0, 0, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
		MPI_Recv (&bc, 1, MPI_DOUBLE, 0, 0, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
		MPI_Recv (&min_found, 1, MPI_INT, 0, 0, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
	}
    else
	{
		for(k = 1; k < size_is; k++)
		{
			MPI_Recv (&pError, 1, MPI_DOUBLE, k, 0, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
			MPI_Recv (&dm[k-1] , 1, MPI_DOUBLE, k, 0, MPI_COMM_WORLD, MPI_STATUS_IGNORE);
			MPI_Recv (&dc[k-1], 1, MPI_DOUBLE, k, 0, MPI_COMM_WORLD, MPI_STATUS_IGNORE);

			if(pError < best_error)
			{
				best_error = pError;
				best_error_i = k - 1;
			}
		}

		if(best_error < be)
		{
			be = best_error;
			bm = dm[best_error_i];
			bc = dc[best_error_i];
		}
		
		else
		{
			min_found = 1;
		}
		
		for(k = 1; k < size_is; k++)
		{
			MPI_Send (&bm, 1, MPI_DOUBLE, k, 0, MPI_COMM_WORLD);
			MPI_Send (&bc, 1, MPI_DOUBLE, k, 0, MPI_COMM_WORLD);
			MPI_Send (&min_found, 1, MPI_INT, k, 0, MPI_COMM_WORLD);

		}
	}
    }

    if(rank_is == 0)
      {
	printf("minimum slope,c is %lf,%lf with error %lf\n", bm, bc, be);

   clock_gettime(CLOCK_MONOTONIC, &end);
   t_difference(&start, &end, &time_taken);
   printf("Total time taken was %lldns or %0.9lfs\n", time_taken, (time_taken/1.0e9)); 
      }

  MPI_Finalize();
  return 0;
}

